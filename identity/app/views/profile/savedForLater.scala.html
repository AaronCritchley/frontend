@import com.gu.identity.model.SavedArticle
@import model.Content

@(page: model.MetaData, savedArticleForm: Form[SavedArticleData], articles: List[Content], formActionUrl: String )(implicit request: RequestHeader)

@import implicits.Articles._
@import views.support.ImgSrc
@import layout.ContentWidths.BodyMedia

@savedArticle(articles: List[Content]) = {
    @articles.zipWithRowInfo.map { case (article, row) =>
    <div class="@RenderClasses(Map(
        "u-cf" -> true,
        "saved-content" -> true,
        "js-saved-content" -> true,
        "saved-content-first" -> row.isFirst))" shortUrl="@article.shortUrlPath">

        <input type="hidden" name="article[@row.rowNum]" value="@article.shortUrlPath"/>
        <div class="saved-content__img media__img">

        <!--
        @article.trailPicture.map { image =>
            <img class="responsiveimg" src="@Item120.bestFor(image)" alt="" />
        }
        @fragments.img(article.trailPicture(5,3), false, false, false, Some(article.url), false)
        -->

        @article.trailPicture.map { picture  =>



            <img src="@ImgSrc.getFallbackUrl(picture)"
            srcset="@ImgSrc.srcset(picture, BodyMedia.Thumbnail)"
            sizes="@BodyMedia.Thumbnail.sizes"
            class="maxed responsive-img"
            itemprop="contentUrl representativeOfPage"
            alt="@ImgSrc.getFallbackAsset(picture).flatMap(_.altText).getOrElse("")" />
        }

        </div>

        <div class=="saved-content__meta">
            <a class="saved-content__title" href="@article.webUrl">@article.webTitle</a>
            <div class="saved-content__standfirst">@article.trailText</div>
        </div>
            <!--    <div class="saved-content__read">not read</div> -->

        <div class="saved-content__meta u-cf">
            <button class="saved-content__button js-saved-content__button"
            data-link-name="Delete"
            name="deleteArticle"
            type="submit"
            value="@article.shortUrlPath">
        Delete
    </button>
            <!-- <div class="saved-content__saved-at">Summat else</div> -->
    </div>
    </div>
    }
}

@main(page, projectName = Option("identity")) {
}{
    <div class="identity-wrapper monocolumn-wrapper">
        <h1 class="identity-title">Saved Articles</h1>
        @if(savedArticleForm.globalError.isDefined) {
            <div class="form__error">@savedArticleForm.globalErrors.map(_.message).mkString(", ")</div>
        }
            <!-- Open form here and handle errors here -->
        <form class="form js-saved-content-form" novalidate action="@formActionUrl" role="main" method="post">
            <div class="saved-contents js-saved-contents">
            @savedArticle(articles)
            </div>
            <fieldset class="fieldset">
                <ul class="u-unstyled">

                    <li class="form-field">
                        <label class="label"> Delete individual articles with the button above, or click below to remove them all</label>
                        <div class="form-field__note js-saved-content__num-articles">
                            you have @articles.length saved articles
                        </div>
                    </li>

                    <li>
                        <button type="submit" class="submit-input js-saved-content__button-delete-all" name="deleteArticle" value="all" data-link-name="Saved deletre all">Delete All</button>
                    </li>
                </ul>
            </fieldset>
        </form>
    </div>
}
